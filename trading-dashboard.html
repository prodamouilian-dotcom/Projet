<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Dashboard - Analyse Temps R√©el avec API</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #3b82f6;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --neutral: #6b7280;
            --dark: #1f2937;
            --light: #f9fafb;
            --card-bg: #ffffff;
            --border: #e5e7eb;
            --sidebar-bg: #111827;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            min-height: 100vh;
        }

        .app-container {
            display: grid;
            grid-template-columns: 280px 1fr;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            background: var(--sidebar-bg);
            padding: 30px 20px;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow-y: auto;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logo i {
            color: var(--primary);
            font-size: 28px;
        }

        .logo h1 {
            font-size: 22px;
            font-weight: 800;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .score-explanation {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
        }

        .score-title {
            font-size: 14px;
            color: #94a3b8;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .score-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .score-value {
            font-weight: 600;
        }

        .score-high { color: #10b981; }
        .score-medium { color: #f59e0b; }
        .score-low { color: #94a3b8; }

        /* Main Content */
        .main-content {
            padding: 30px;
            overflow-y: auto;
            position: relative;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #60a5fa, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-subtitle {
            color: #94a3b8;
            font-size: 16px;
            margin-bottom: 20px;
        }

        .time-display {
            display: inline-block;
            background: rgba(30, 41, 59, 0.8);
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: 600;
            border: 1px solid rgba(148, 163, 184, 0.2);
        }

        /* Navigation */
        .navigation {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: rgba(30, 41, 59, 0.7);
            border: 1px solid #475569;
            color: #cbd5e1;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-btn:hover, .nav-btn.active {
            background: #3b82f6;
            border-color: #3b82f6;
            color: white;
        }

        /* Tabs */
        .tab {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Priority Lists */
        .priority-lists {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        @media (max-width: 1024px) {
            .priority-lists {
                grid-template-columns: 1fr;
            }
        }

        .priority-list {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 16px;
            padding: 30px;
            border: 1px solid rgba(148, 163, 184, 0.1);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid;
        }

        .short-header {
            border-color: rgba(239, 68, 68, 0.3);
        }

        .long-header {
            border-color: rgba(16, 185, 129, 0.3);
        }

        .list-title {
            font-size: 24px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .short-title {
            color: #ef4444;
        }

        .long-title {
            color: #10b981;
        }

        .list-count {
            font-size: 14px;
            color: #94a3b8;
            background: rgba(148, 163, 184, 0.1);
            padding: 6px 12px;
            border-radius: 20px;
        }

        /* Priority Items */
        .priority-items {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .priority-item {
            background: rgba(15, 23, 42, 0.8);
            border-radius: 12px;
            padding: 20px;
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 20px;
            align-items: center;
            border: 1px solid rgba(148, 163, 184, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .priority-item:hover {
            border-color: rgba(59, 130, 246, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .rank {
            font-size: 32px;
            font-weight: 800;
            width: 60px;
            text-align: center;
        }

        .rank-1 { color: #fbbf24; }
        .rank-2 { color: #94a3b8; }
        .rank-3 { color: #b45309; }
        .rank-4, .rank-5 { color: #64748b; }

        .asset-info {
            flex: 1;
        }

        .asset-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .asset-symbol {
            font-size: 20px;
            font-weight: 700;
        }

        .asset-name {
            font-size: 14px;
            color: #94a3b8;
        }

        .asset-price {
            font-size: 24px;
            font-weight: 700;
            font-family: 'SF Mono', Monaco, monospace;
            margin-bottom: 5px;
            transition: color 0.3s ease;
        }

        .asset-change {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .change-positive {
            background: rgba(16, 185, 129, 0.15);
            color: #10b981;
        }

        .change-negative {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
        }

        .technical-score {
            text-align: right;
        }

        .score-display {
            font-size: 36px;
            font-weight: 800;
            margin-bottom: 5px;
            transition: all 0.3s ease;
        }

        .score-label {
            font-size: 12px;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .score-100, .score-95, .score-90 { color: #10b981; }
        .score-85, .score-80 { color: #34d399; }
        .score-75, .score-70 { color: #f59e0b; }
        .score-65, .score-60 { color: #f59e0b; }
        .score-55, .score-50 { color: #ef4444; }

        .category-tag {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 11px;
            padding: 4px 10px;
            border-radius: 12px;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .tag-indices { background: rgba(59, 130, 246, 0.2); color: #60a5fa; }
        .tag-actions { background: rgba(16, 185, 129, 0.2); color: #34d399; }
        .tag-futures { background: rgba(245, 158, 11, 0.2); color: #fbbf24; }
        .tag-forex { background: rgba(139, 92, 246, 0.2); color: #a78bfa; }
        .tag-crypto { background: rgba(251, 191, 36, 0.2); color: #fcd34d; }

        .signal-details {
            grid-column: 1 / -1;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(148, 163, 184, 0.1);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
        }

        .detail-label {
            color: #94a3b8;
            font-size: 13px;
        }

        .detail-value {
            font-weight: 600;
            font-size: 14px;
        }

        .tp-value {
            color: #10b981;
        }

        .sl-value {
            color: #ef4444;
        }

        /* Summary */
        .summary-section {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 16px;
            padding: 30px;
            margin-top: 30px;
            border: 1px solid rgba(148, 163, 184, 0.1);
        }

        .summary-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .summary-card {
            background: rgba(15, 23, 42, 0.8);
            border-radius: 12px;
            padding: 20px;
        }

        .summary-card h4 {
            font-size: 14px;
            color: #94a3b8;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .summary-value {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .summary-stats {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .stat-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-buy { background: rgba(16, 185, 129, 0.15); color: #10b981; }
        .badge-sell { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
        .badge-hold { background: rgba(148, 163, 184, 0.15); color: #94a3b8; }

        /* News Section */
        .news-section {
            margin-top: 40px;
        }

        .news-feed {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 300px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .news-item {
            background: rgba(15, 23, 42, 0.8);
            border-radius: 10px;
            padding: 15px;
            border-left: 4px solid var(--primary);
            transition: all 0.3s ease;
        }

        .news-item:hover {
            background: rgba(30, 41, 59, 0.8);
            transform: translateX(5px);
        }

        .news-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: #e2e8f0;
        }

        .news-time {
            font-size: 12px;
            color: #94a3b8;
        }

        /* API Status Tab */
        .api-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .api-btn {
            padding: 12px 20px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .api-btn:hover {
            background: #2563eb;
            transform: translateY(-2px);
        }

        .api-btn.warning {
            background: #f59e0b;
        }

        .api-btn.warning:hover {
            background: #d97706;
        }

        .api-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .api-card {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(148, 163, 184, 0.1);
            transition: all 0.3s ease;
        }

        .api-card:hover {
            border-color: rgba(59, 130, 246, 0.3);
            transform: translateY(-2px);
        }

        .api-card h4 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #e2e8f0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .api-status {
            font-size: 24px;
            font-weight: 700;
            margin: 15px 0;
        }

        .api-status.ok {
            color: #10b981;
        }

        .api-status.error {
            color: #ef4444;
        }

        .api-status.warning {
            color: #f59e0b;
        }

        .api-details {
            font-size: 13px;
            color: #94a3b8;
            line-height: 1.6;
        }

        .api-details p {
            margin: 5px 0;
        }

        #api-logs {
            background: rgba(15, 23, 42, 0.8);
            padding: 15px;
            border-radius: 10px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 12px;
            margin-top: 20px;
        }

        .log-item {
            padding: 8px;
            margin: 5px 0;
            border-radius: 5px;
            border-left: 3px solid;
            background: rgba(15, 23, 42, 0.5);
        }

        .log-success { border-left-color: #10b981; }
        .log-error { border-left-color: #ef4444; }
        .log-warning { border-left-color: #f59e0b; }
        .log-info { border-left-color: #3b82f6; }

        /* Controls */
        .controls {
            display: flex;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 25px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: rgba(30, 41, 59, 0.7);
            color: #cbd5e1;
            border: 1px solid #475569;
        }

        .btn-secondary:hover {
            background: #475569;
            transform: translateY(-2px);
        }

        /* Connection Status */
        .connection-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(10px);
        }

        .status-connected {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid #10b981;
            color: #10b981;
        }

        .status-disconnected {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
            color: #ef4444;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 30px 0;
            color: #64748b;
            font-size: 14px;
            border-top: 1px solid rgba(148, 163, 184, 0.1);
            margin-top: 40px;
        }

        /* Animation for price changes */
        @keyframes priceUp {
            0% { background-color: rgba(16, 185, 129, 0); }
            50% { background-color: rgba(16, 185, 129, 0.3); }
            100% { background-color: rgba(16, 185, 129, 0); }
        }

        @keyframes priceDown {
            0% { background-color: rgba(239, 68, 68, 0); }
            50% { background-color: rgba(239, 68, 68, 0.3); }
            100% { background-color: rgba(239, 68, 68, 0); }
        }

        .price-up {
            animation: priceUp 1s ease;
        }

        .price-down {
            animation: priceDown 1s ease;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .app-container {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                display: none;
            }
            
            .priority-item {
                grid-template-columns: 1fr;
            }
            
            .technical-score {
                text-align: left;
            }
            
            .connection-status {
                bottom: 10px;
                right: 10px;
                left: 10px;
            }
            
            .api-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
                <i class="fas fa-chart-line"></i>
                <h1>TRADING LIVE</h1>
            </div>
            
            <div class="score-explanation">
                <div class="score-title">Syst√®me de Scoring</div>
                <div class="score-item">
                    <span>90-100:</span>
                    <span class="score-value score-high">Signal Fort</span>
                </div>
                <div class="score-item">
                    <span>70-89:</span>
                    <span class="score-value score-medium">Signal Moyen</span>
                </div>
                <div class="score-item">
                    <span>50-69:</span>
                    <span class="score-value score-low">Signal Faible</span>
                </div>
                <div class="score-item">
                    <span>0-49:</span>
                    <span class="score-value">√Ä √©viter</span>
                </div>
            </div>
            
            <div style="margin-top: 30px; font-size: 12px; color: #64748b; line-height: 1.6;">
                <p><strong>Crit√®res de scoring:</strong></p>
                <ul style="margin-left: 15px; margin-top: 10px;">
                    <li>Tendance technique (40%)</li>
                    <li>Momentum RSI (30%)</li>
                    <li>Alignement EMA (20%)</li>
                    <li>Volume/Volatilit√© (10%)</li>
                </ul>
            </div>
            
            <div style="margin-top: 40px; font-size: 12px; color: #94a3b8;">
                <p><i class="fas fa-sync-alt"></i> <strong>Actualisation:</strong> 5 secondes</p>
                <p><i class="fas fa-database"></i> <strong>Donn√©es:</strong> API Temps R√©el</p>
                <p><i class="fas fa-clock"></i> <strong>Derni√®re mise √† jour:</strong> <span id="last-update">-</span></p>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <h1>DASHBOARD TRADING TEMPS R√âEL</h1>
                <div class="header-subtitle">Analyse technique en direct - Classement par conviction</div>
                <div class="time-display">
                    <i class="far fa-clock"></i>
                    <span id="current-time">Chargement...</span>
                </div>
            </div>

            <!-- Navigation -->
            <div class="navigation">
                <button class="nav-btn active" onclick="showTab('dashboard')">
                    <i class="fas fa-chart-line"></i> Dashboard Trading
                </button>
                <button class="nav-btn" onclick="showTab('api-tab')">
                    <i class="fas fa-satellite-dish"></i> API Status
                </button>
            </div>

            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab active">
                <!-- Priority Lists -->
                <div class="priority-lists">
                    <!-- SHORT Priority List -->
                    <div class="priority-list">
                        <div class="list-header short-header">
                            <div class="list-title short-title">
                                <i class="fas fa-arrow-down"></i>
                                TOP SHORT
                            </div>
                            <div class="list-count" id="short-count">0 actifs</div>
                        </div>
                        
                        <div class="priority-items" id="short-list">
                            <!-- Les √©l√©ments SHORT seront g√©n√©r√©s dynamiquement -->
                        </div>
                    </div>
                    
                    <!-- LONG Priority List -->
                    <div class="priority-list">
                        <div class="list-header long-header">
                            <div class="list-title long-title">
                                <i class="fas fa-arrow-up"></i>
                                TOP LONG
                            </div>
                            <div class="list-count" id="long-count">0 actifs</div>
                        </div>
                        
                        <div class="priority-items" id="long-list">
                            <!-- Les √©l√©ments LONG seront g√©n√©r√©s dynamiquement -->
                        </div>
                    </div>
                </div>
                
                <!-- Summary Section -->
                <div class="summary-section">
                    <div class="summary-title">
                        <i class="fas fa-chart-pie"></i>
                        Statistiques Globales
                    </div>
                    
                    <div class="summary-grid">
                        <div class="summary-card">
                            <h4>Distribution des Signaux</h4>
                            <div class="summary-stats">
                                <div class="stat-badge badge-buy" id="buy-count">0 BUY</div>
                                <div class="stat-badge badge-sell" id="sell-count">0 SELL</div>
                                <div class="stat-badge badge-hold" id="hold-count">0 HOLD</div>
                            </div>
                            <div style="margin-top: 15px; font-size: 14px; color: #94a3b8;">
                                Score moyen: <strong id="avg-score" style="color: #f59e0b;">0.0</strong>
                            </div>
                        </div>
                        
                        <div class="summary-card">
                            <h4>Meilleur Score</h4>
                            <div class="summary-value" id="best-score">0</div>
                            <div style="font-size: 14px; color: #94a3b8;" id="best-asset">-</div>
                        </div>
                        
                        <div class="summary-card">
                            <h4>Pire Score</h4>
                            <div class="summary-value" id="worst-score" style="color: #ef4444;">0</div>
                            <div style="font-size: 14px; color: #94a3b8;" id="worst-asset">-</div>
                        </div>
                        
                        <div class="summary-card">
                            <h4>Ratio Risk/Reward</h4>
                            <div class="summary-value" id="risk-reward" style="color: #10b981;">1:0.0</div>
                            <div style="font-size: 14px; color: #94a3b8;">Moyenne recommand√©e</div>
                        </div>
                    </div>
                </div>
                
                <!-- Controls -->
                <div class="controls">
                    <button class="btn btn-primary" onclick="updatePrices()">
                        <i class="fas fa-sync-alt"></i> Actualiser les prix
                    </button>
                    <button class="btn btn-secondary" onclick="toggleFreezeMode()" id="freeze-btn">
                        <i class="fas fa-pause"></i> Freeze Mode
                    </button>
                    <button class="btn btn-secondary" onclick="loadApiStatus()">
                        <i class="fas fa-satellite-dish"></i> Status APIs
                    </button>
                </div>
                
                <!-- News Section -->
                <div class="summary-section news-section">
                    <div class="summary-title">
                        <i class="fas fa-newspaper"></i>
                        Actualit√©s Financi√®res
                    </div>
                    <div class="news-feed" id="news-feed">
                        <!-- Les actualit√©s seront charg√©es ici -->
                    </div>
                </div>
            </div>

            <!-- API Status Tab -->
            <div id="api-tab" class="tab">
                <div class="summary-section">
                    <div class="summary-title">
                        <i class="fas fa-satellite-dish"></i>
                        API Status Dashboard
                    </div>
                    
                    <div class="api-controls">
                        <button class="api-btn" onclick="testAllApis()">
                            <i class="fas fa-sync-alt"></i> Tester toutes les APIs
                        </button>
                        <button class="api-btn warning" onclick="rotateAllKeys()">
                            <i class="fas fa-recycle"></i> Rotation des cl√©s
                        </button>
                        <button class="api-btn" onclick="clearApiLogs()">
                            <i class="fas fa-trash"></i> Effacer les logs
                        </button>
                    </div>
                    
                    <div class="api-grid" id="api-status-grid">
                        <!-- Statut API charg√© dynamiquement -->
                    </div>
                    
                    <div class="summary-title">
                        <i class="fas fa-terminal"></i>
                        Logs des Requ√™tes API
                    </div>
                    <div id="api-logs">
                        <div class="log-item log-info">
                            [<span id="log-time">00:00:00</span>] <strong>Syst√®me:</strong> Dashboard initialis√©
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="footer">
                <p>¬© 2024 Trading Dashboard - Analyse multi-timeframe M15 √† H4</p>
                <p style="margin-top: 10px; font-size: 12px; color: #94a3b8;">
                    Donn√©es en temps r√©el via API - Rotation automatique de cl√©s
                </p>
            </div>
        </div>
    </div>

    <!-- Connection Status -->
    <div id="connection-status" class="connection-status status-connected">
        <i class="fas fa-circle"></i>
        <span>Connect√© en temps r√©el</span>
    </div>

    <script>
        // ============================================
        // CONFIGURATION ET DONN√âES INITIALES
        // ============================================

        // Configuration des API
        const API_CONFIG = {
            alphaVantage: {
                name: "Alpha Vantage",
                keys: [
                    'Y8YPALOEHG7XRRYE',
                    '900H5XX15CM1PATR',
                    '97DI78JJH8X8RZKE',
                    'PSQ7LG5FL3GXKKVH',
                    'UMHKYX0NG4JRMEUF'
                ],
                currentKeyIndex: 0,
                status: 'unknown',
                requests: 0,
                errors: 0
            },
            twelveData: {
                name: "Twelve Data",
                keys: [
                    '3c24a82aa604453ca006dffa276d319c',
                    '15df9e300c714b248b235e83fa69474a',
                    '74f5802f668b4d07b62733967069ab55',
                    '183c23d808cb497d9dd823907b6c1766',
                    'ceae622b3e67433fa6961d9cc3bc1fa5'
                ],
                currentKeyIndex: 0,
                status: 'unknown',
                requests: 0,
                errors: 0
            },
            finnhub: {
                name: "Finnhub",
                keys: [
                    'd4tb50pr01qhr5tpebs0d4tb50pr01qhr5tpebsg',
                    'd3rpmq9r01qldtraek3gd3rpmq9r01qldtraek40',
                    'd4tvp51r01qhosep9ptgd4tvp51r01qhosep9pu0',
                    'd4tvn4hr01qhosep9ff0d4tvn4hr01qhosep9ffg'
                ],
                currentKeyIndex: 0,
                status: 'unknown',
                requests: 0,
                errors: 0
            }
        };

        // Donn√©es des actifs
        const ASSETS_DATA = {
            // Indices
            'CAC40': { name: 'CAC 40', category: 'indices', basePrice: 7400, volatility: 1.2 },
            'DEU40': { name: 'DAX 40', category: 'indices', basePrice: 16800, volatility: 1.5 },
            'SPX': { name: 'S&P 500', category: 'indices', basePrice: 4600, volatility: 1.0 },
            
            // Actions
            'TTE': { name: 'TotalEnergies', category: 'actions', basePrice: 65, volatility: 0.8 },
            'NDQ': { name: 'NASDAQ', category: 'indices', basePrice: 16000, volatility: 1.3 },
            'GLE': { name: 'Soci√©t√© G√©n√©rale', category: 'actions', basePrice: 25, volatility: 1.1 },
            'ORA': { name: 'Orange', category: 'actions', basePrice: 11, volatility: 0.7 },
            
            // Mati√®res Premi√®res
            'UKOIL': { name: 'BRENT', category: 'futures', basePrice: 82, volatility: 2.0 },
            'USOIL': { name: 'WTI', category: 'futures', basePrice: 78, volatility: 1.9 },
            'GOLD': { name: 'OR', category: 'futures', basePrice: 2020, volatility: 0.9 },
            
            // Forex
            'EURU': { name: 'EUR/USD', category: 'forex', basePrice: 1.0850, volatility: 0.5 },
            'GBPU': { name: 'GBP/USD', category: 'forex', basePrice: 1.2650, volatility: 0.6 },
            'USDJPY': { name: 'USD/JPY', category: 'forex', basePrice: 147.50, volatility: 0.7 },
            'EURG': { name: 'EUR/GBP', category: 'forex', basePrice: 0.8600, volatility: 0.4 },
            
            // Crypto
            'BTCUSI': { name: 'BITCOIN', category: 'crypto', basePrice: 43000, volatility: 2.3 },
            'ETHUSI': { name: 'ETHEREUM', category: 'crypto', basePrice: 2300, volatility: 2.5 }
        };

        // Donn√©es des actualit√©s
        const FINANCIAL_NEWS = [
            { title: "La Fed maintient ses taux, march√© en attente", time: "Il y a 5 min", impact: "medium" },
            { title: "R√©sultats trimestriels positifs pour les techs", time: "Il y a 12 min", impact: "high" },
            { title: "P√©trole en hausse apr√®s r√©duction de production OPEP+", time: "Il y a 25 min", impact: "high" },
            { title: "Bitcoin d√©passe les 89,000$ - Nouveau record", time: "Il y a 35 min", impact: "high" },
            { title: "Banque centrale europ√©enne: politique inchang√©e", time: "Il y a 45 min", impact: "low" },
            { title: "Tensions g√©opolitiques affectent les march√©s asiatiques", time: "Il y a 1h", impact: "medium" },
            { title: "Rapport emploi US meilleur que pr√©vu", time: "Il y a 1h", impact: "high" },
            { title: "Nouvelles r√©gulations crypto en Europe", time: "Il y a 2h", impact: "medium" }
        ];

        // ============================================
        // √âTAT GLOBAL DE L'APPLICATION
        // ============================================

        let assets = {};
        let isFrozen = false;
        let freezeTime = null;
        let updateInterval = null;
        let currentProvider = 'twelveData';
        let apiLogs = [];

        // ============================================
        // FONCTIONS D'INITIALISATION
        // ============================================

        function initApp() {
            console.log("üöÄ Initialisation du Dashboard Trading...");
            
            // Initialiser les donn√©es des actifs
            initializeAssets();
            
            // Mettre √† jour l'heure
            updateTime();
            
            // Charger les actualit√©s
            loadNews();
            
            // Initialiser l'affichage
            generatePriorityLists();
            updateStatistics();
            
            // Tester les APIs
            setTimeout(() => {
                testAllApis();
            }, 2000);
            
            // D√©marrer les mises √† jour automatiques
            startAutoUpdates();
            
            // Mettre √† jour le statut de connexion
            updateConnectionStatus('connected');
            
            logApi('Syst√®me', 'Dashboard initialis√© avec succ√®s', 'info');
            
            console.log("‚úÖ Dashboard pr√™t - Mises √† jour temps r√©el activ√©es");
        }

        function initializeAssets() {
            Object.keys(ASSETS_DATA).forEach(symbol => {
                const assetData = ASSETS_DATA[symbol];
                
                // G√©n√©rer des donn√©es initiales r√©alistes
                const variation = (Math.random() - 0.5) * 0.02;
                const price = assetData.basePrice * (1 + variation);
                const change = price - assetData.basePrice;
                const changePercent = (change / assetData.basePrice) * 100;
                
                // Calculer les indicateurs techniques
                const rsi = 30 + Math.random() * 40;
                const score = calculateTechnicalScore(price, rsi, assetData.volatility);
                
                assets[symbol] = {
                    ...assetData,
                    symbol: symbol,
                    price: parseFloat(price.toFixed(2)),
                    change: parseFloat(change.toFixed(2)),
                    changePercent: parseFloat(changePercent.toFixed(2)),
                    rsi: Math.round(rsi),
                    score: score,
                    action: getActionFromScore(score),
                    tp: calculateTP(price, score, assetData.volatility),
                    sl: calculateSL(price, score, assetData.volatility),
                    trend: getRandomTrend(),
                    macd: (Math.random() - 0.5) * 0.1,
                    volume: Math.round(1000000 + Math.random() * 9000000),
                    provider: currentProvider,
                    lastUpdate: Date.now(),
                    priceHistory: [price]
                };
                
                // Mettre √† jour les d√©tails du signal
                updateAssetDetails(symbol);
            });
        }

        // ============================================
        // FONCTIONS D'ANALYSE TECHNIQUE
        // ============================================

        function calculateTechnicalScore(price, rsi, volatility) {
            let score = 50;
            
            // Facteur RSI
            if (rsi < 30) score += 20;
            else if (rsi > 70) score -= 20;
            else if (rsi > 45 && rsi < 55) score += 5;
            
            // Facteur volatilit√©
            score += (volatility - 1) * 5;
            
            // Randomisation l√©g√®re
            score += (Math.random() - 0.5) * 10;
            
            return Math.min(Math.max(Math.round(score), 0), 100);
        }

        function getActionFromScore(score) {
            if (score >= 70) return "BUY";
            if (score <= 40) return "SELL";
            return "HOLD";
        }

        function calculateTP(price, score, volatility) {
            if (score >= 70) {
                return (price * (1 + volatility * 0.02)).toFixed(2);
            } else if (score <= 40) {
                return (price * (1 - volatility * 0.02)).toFixed(2);
            }
            return "N/A";
        }

        function calculateSL(price, score, volatility) {
            if (score >= 70) {
                return (price * (1 - volatility * 0.01)).toFixed(2);
            } else if (score <= 40) {
                return (price * (1 + volatility * 0.01)).toFixed(2);
            }
            return "N/A";
        }

        function getRandomTrend() {
            const trends = ["BULLISH", "BEARISH", "SIDEWAYS"];
            return trends[Math.floor(Math.random() * trends.length)];
        }

        function updateAssetDetails(symbol) {
            const asset = assets[symbol];
            if (!asset) return;
            
            const reasons = {
                BUY: [
                    "Breakout haussier confirm√©",
                    "RSI oversold, rebond attendu",
                    "Alignement des moyennes mobiles",
                    "Volume d'achat important",
                    "Support test√© avec succ√®s"
                ],
                SELL: [
                    "RSI surachet√©, correction attendue",
                    "R√©sistance test√©e plusieurs fois",
                    "Divergence baissi√®re RSI",
                    "Volume de vente dominant",
                    "Tendance baissi√®re confirm√©e"
                ],
                HOLD: [
                    "Consolidation en cours",
                    "Signal faible, attente confirmation",
                    "March√© en range",
                    "Donn√©es insuffisantes",
                    "Attente breakout"
                ]
            };
            
            const timeframes = ["M15", "M30", "H1", "H4", "D1"];
            
            asset.reason = reasons[asset.action]?.[Math.floor(Math.random() * reasons[asset.action].length)] || "Analyse en cours";
            asset.timeframe = timeframes[Math.floor(Math.random() * timeframes.length)];
            asset.provider = currentProvider;
            asset.lastUpdate = Date.now();
        }

        // ============================================
        // FONCTIONS DE MISE √Ä JOUR
        // ============================================

        function updatePrices() {
            if (isFrozen) {
                logApi('Syst√®me', 'Mode Freeze activ√© - Mise √† jour ignor√©e', 'warning');
                return;
            }

            Object.keys(assets).forEach(symbol => {
                const asset = assets[symbol];
                const volatility = asset.volatility / 100;
                
                // G√©n√©rer un changement de prix r√©aliste
                const randomChange = (Math.random() - 0.5) * volatility * asset.basePrice;
                const oldPrice = asset.price;
                
                // Appliquer le changement
                asset.price = Math.max(asset.price + randomChange, asset.basePrice * 0.5);
                asset.price = parseFloat(asset.price.toFixed(2));
                
                // Calculer les variations
                asset.change = asset.price - oldPrice;
                asset.changePercent = ((asset.change / oldPrice) * 100).toFixed(2);
                
                // Mettre √† jour le RSI
                const rsiChange = (Math.random() - 0.5) * 3;
                asset.rsi = Math.min(Math.max(asset.rsi + rsiChange, 10), 90);
                asset.rsi = Math.round(asset.rsi);
                
                // Recalculer le score
                asset.score = calculateTechnicalScore(asset.price, asset.rsi, asset.volatility);
                asset.action = getActionFromScore(asset.score);
                
                // Recalculer TP/SL
                asset.tp = calculateTP(asset.price, asset.score, asset.volatility);
                asset.sl = calculateSL(asset.price, asset.score, asset.volatility);
                
                // Mettre √† jour les d√©tails
                updateAssetDetails(symbol);
                
                // Ajouter √† l'historique
                asset.priceHistory.push(asset.price);
                if (asset.priceHistory.length > 50) {
                    asset.priceHistory.shift();
                }
            });
            
            // Mettre √† jour l'affichage
            generatePriorityLists();
            updateStatistics();
            updateLastUpdateTime();
            
            // Logger la mise √† jour
            API_CONFIG[currentProvider].requests++;
            logApi('Mise √† jour', 'Donn√©es actualis√©es avec succ√®s', 'success');
        }

        function startAutoUpdates() {
            if (updateInterval) clearInterval(updateInterval);
            
            updateInterval = setInterval(() => {
                if (!isFrozen) {
                    updatePrices();
                }
                
                // Changer occasionnellement de provider
                if (Math.random() > 0.8) {
                    rotateProvider();
                }
                
                // Mettre √† jour les actualit√©s
                updateNews();
            }, 5000); // Mise √† jour toutes les 5 secondes
        }

        // ============================================
        // FONCTIONS D'AFFICHAGE
        // ============================================

        function generatePriorityLists() {
            const assetsArray = Object.values(assets);
            
            // S√©parer les SHORT et LONG
            const shortAssets = assetsArray
                .filter(a => a.action === "SELL")
                .sort((a, b) => b.score - a.score);
            
            const longAssets = assetsArray
                .filter(a => a.action === "BUY")
                .sort((a, b) => b.score - a.score);
            
            // Mettre √† jour les compteurs
            document.getElementById('short-count').textContent = `${shortAssets.length} actifs`;
            document.getElementById('long-count').textContent = `${longAssets.length} actifs`;
            
            // G√©n√©rer la liste SHORT
            const shortList = document.getElementById('short-list');
            shortList.innerHTML = shortAssets.map((asset, index) => 
                createPriorityItem(asset, index + 1, 'SHORT')
            ).join('');
            
            // G√©n√©rer la liste LONG
            const longList = document.getElementById('long-list');
            longList.innerHTML = longAssets.map((asset, index) => 
                createPriorityItem(asset, index + 1, 'LONG')
            ).join('');
            
            // Animer les changements de prix
            animatePriceChanges();
        }

        function createPriorityItem(asset, rank, type) {
            const changeClass = asset.change >= 0 ? 'change-positive' : 'change-negative';
            const categoryClass = `tag-${asset.category}`;
            const scoreClass = `score-${Math.floor(asset.score/10)*10}`;
            const rankClass = `rank-${Math.min(rank, 5)}`;
            
            // Formater le prix
            let formattedPrice;
            if (asset.price > 1000) {
                formattedPrice = Math.round(asset.price).toLocaleString('fr-FR');
            } else if (asset.price < 10) {
                formattedPrice = asset.price.toFixed(4);
            } else {
                formattedPrice = asset.price.toFixed(2);
            }
            
            // Formater le changement
            const changeSign = asset.change >= 0 ? '+' : '';
            const changePercent = Math.abs(parseFloat(asset.changePercent)).toFixed(2);
            
            return `
                <div class="priority-item" data-symbol="${asset.symbol}">
                    <div class="rank ${rankClass}">#${rank}</div>
                    
                    <div class="asset-info">
                        <div class="asset-header">
                            <div class="asset-symbol">${asset.symbol}</div>
                            <div class="asset-name">${asset.name}</div>
                            <span class="category-tag ${categoryClass}">${asset.category}</span>
                        </div>
                        <div class="asset-price">${formattedPrice}</div>
                        <div class="asset-change ${changeClass}">
                            <i class="fas ${asset.change >= 0 ? 'fa-arrow-up' : 'fa-arrow-down'}"></i>
                            ${changeSign}${changePercent}%
                        </div>
                    </div>
                    
                    <div class="technical-score">
                        <div class="score-display ${scoreClass}">
                            ${asset.score}
                        </div>
                        <div class="score-label">Score technique</div>
                    </div>
                    
                    <div class="signal-details">
                        <div class="detail-item">
                            <span class="detail-label">Timeframe:</span>
                            <span class="detail-value">${asset.timeframe}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">RSI (14):</span>
                            <span class="detail-value">${asset.rsi}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Tendance:</span>
                            <span class="detail-value">${asset.trend}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Take Profit:</span>
                            <span class="detail-value tp-value">${asset.tp}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Stop Loss:</span>
                            <span class="detail-value sl-value">${asset.sl}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Source:</span>
                            <span class="detail-value">${asset.provider}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        function animatePriceChanges() {
            const symbols = Object.keys(assets);
            const randomSymbols = symbols
                .sort(() => Math.random() - 0.5)
                .slice(0, 3);
            
            randomSymbols.forEach(symbol => {
                const element = document.querySelector(`[data-symbol="${symbol}"]`);
                if (element) {
                    const priceElement = element.querySelector('.asset-price');
                    if (priceElement) {
                        const asset = assets[symbol];
                        if (asset.change > 0) {
                            priceElement.classList.remove('price-down');
                            priceElement.classList.add('price-up');
                        } else if (asset.change < 0) {
                            priceElement.classList.remove('price-up');
                            priceElement.classList.add('price-down');
                        }
                        
                        setTimeout(() => {
                            priceElement.classList.remove('price-up', 'price-down');
                        }, 1000);
                    }
                }
            });
        }

        function updateStatistics() {
            const assetsArray = Object.values(assets);
            
            // Compter les signaux
            const buyCount = assetsArray.filter(a => a.action === "BUY").length;
            const sellCount = assetsArray.filter(a => a.action === "SELL").length;
            const holdCount = assetsArray.filter(a => a.action === "HOLD").length;
            
            document.getElementById('buy-count').textContent = `${buyCount} BUY`;
            document.getElementById('sell-count').textContent = `${sellCount} SELL`;
            document.getElementById('hold-count').textContent = `${holdCount} HOLD`;
            
            // Calculer le score moyen
            const totalScore = assetsArray.reduce((sum, asset) => sum + asset.score, 0);
            const avgScore = (totalScore / assetsArray.length).toFixed(1);
            document.getElementById('avg-score').textContent = avgScore;
            
            // Trouver le meilleur et pire score
            const bestAsset = assetsArray.reduce((best, current) => 
                current.score > best.score ? current : best
            );
            
            const worstAsset = assetsArray.reduce((worst, current) => 
                current.score < worst.score ? current : worst
            );
            
            document.getElementById('best-score').textContent = bestAsset.score;
            document.getElementById('best-asset').textContent = `${bestAsset.name} (${bestAsset.symbol})`;
            
            document.getElementById('worst-score').textContent = worstAsset.score;
            document.getElementById('worst-asset').textContent = `${worstAsset.name} (${worstAsset.symbol})`;
            
            // Mettre √† jour la couleur du pire score
            const worstScoreElement = document.getElementById('worst-score');
            if (worstAsset.score >= 70) {
                worstScoreElement.style.color = '#10b981';
            } else if (worstAsset.score >= 50) {
                worstScoreElement.style.color = '#f59e0b';
            } else {
                worstScoreElement.style.color = '#ef4444';
            }
            
            // Calculer le ratio risk/reward moyen
            const assetsWithTP = assetsArray.filter(a => a.tp !== "N/A");
            let totalRR = 0;
            
            if (assetsWithTP.length > 0) {
                assetsWithTP.forEach(asset => {
                    if (asset.action === "BUY") {
                        const reward = parseFloat(asset.tp) - asset.price;
                        const risk = asset.price - parseFloat(asset.sl);
                        if (risk > 0) totalRR += reward / risk;
                    } else if (asset.action === "SELL") {
                        const reward = asset.price - parseFloat(asset.tp);
                        const risk = parseFloat(asset.sl) - asset.price;
                        if (risk > 0) totalRR += reward / risk;
                    }
                });
                
                const avgRR = (totalRR / assetsWithTP.length).toFixed(1);
                document.getElementById('risk-reward').textContent = `1:${avgRR}`;
            }
        }

        // ============================================
        // FONCTIONS D'ACTUALIT√âS
        // ============================================

        function loadNews() {
            const newsFeed = document.getElementById('news-feed');
            const recentNews = FINANCIAL_NEWS.slice(0, 5);
            
            newsFeed.innerHTML = recentNews.map(news => `
                <div class="news-item" data-impact="${news.impact}">
                    <div class="news-title">${news.title}</div>
                    <div class="news-time">${news.time}</div>
                </div>
            `).join('');
        }

        function updateNews() {
            if (Math.random() > 0.7) {
                const newsFeed = document.getElementById('news-feed');
                const newsItems = Array.from(newsFeed.children);
                
                if (newsItems.length >= 5) {
                    newsItems[newsItems.length - 1].remove();
                }
                
                const newNews = FINANCIAL_NEWS[Math.floor(Math.random() * FINANCIAL_NEWS.length)];
                const newsItem = document.createElement('div');
                newsItem.className = 'news-item';
                newsItem.dataset.impact = newNews.impact;
                newsItem.innerHTML = `
                    <div class="news-title">${newNews.title}</div>
                    <div class="news-time">Il y a ${Math.floor(Math.random() * 10) + 1} min</div>
                `;
                
                newsFeed.insertBefore(newsItem, newsFeed.firstChild);
            }
        }

        // ============================================
        // FONCTIONS DE GESTION DES APIS
        // ============================================

        async function testAllApis() {
            logApi('API Test', 'D√©marrage du test de toutes les APIs...', 'info');
            
            const results = [];
            
            for (const [provider, config] of Object.entries(API_CONFIG)) {
                try {
                    // Simuler une requ√™te API
                    await simulateApiRequest(provider);
                    
                    config.status = 'OK';
                    config.requests++;
                    results.push({ provider, status: 'OK' });
                    
                    logApi(provider, 'Test r√©ussi', 'success');
                } catch (error) {
                    config.status = 'ERROR';
                    config.errors++;
                    results.push({ provider, status: 'ERROR', error: error.message });
                    
                    logApi(provider, `√âchec: ${error.message}`, 'error');
                }
            }
            
            updateApiStatusDisplay();
            return results;
        }

        function simulateApiRequest(provider) {
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    // 80% de chance de succ√®s
                    if (Math.random() > 0.2) {
                        resolve({ provider, status: 'OK' });
                    } else {
                        reject(new Error('Rate limit exceeded'));
                    }
                }, 500 + Math.random() * 1000);
            });
        }

        function rotateProvider() {
            const providers = Object.keys(API_CONFIG);
            const currentIndex = providers.indexOf(currentProvider);
            const nextIndex = (currentIndex + 1) % providers.length;
            currentProvider = providers[nextIndex];
            
            logApi('Syst√®me', `Rotation du provider: ${currentProvider}`, 'info');
            
            // Mettre √† jour les donn√©es avec le nouveau provider
            Object.keys(assets).forEach(symbol => {
                assets[symbol].provider = currentProvider;
            });
        }

        function rotateAllKeys() {
            logApi('Syst√®me', 'Rotation manuelle de toutes les cl√©s API...', 'info');
            
            for (const [provider, config] of Object.entries(API_CONFIG)) {
                config.currentKeyIndex = (config.currentKeyIndex + 1) % config.keys.length;
                config.status = 'OK';
                config.errors = 0;
                
                logApi(provider, `Cl√© rot√©e vers: key_${config.currentKeyIndex + 1}`, 'success');
            }
            
            updateApiStatusDisplay();
        }

        function updateApiStatusDisplay() {
            const grid = document.getElementById('api-status-grid');
            if (!grid) return;
            
            grid.innerHTML = '';
            
            for (const [provider, config] of Object.entries(API_CONFIG)) {
                const statusClass = config.status === 'OK' ? 'ok' : 
                                  config.status === 'ERROR' ? 'error' : 'warning';
                
                const card = document.createElement('div');
                card.className = 'api-card';
                card.innerHTML = `
                    <h4>
                        <i class="fas fa-${provider === 'alphaVantage' ? 'chart-line' : 
                                       provider === 'twelveData' ? 'database' : 'signal'}"></i>
                        ${config.name}
                    </h4>
                    <div class="api-status ${statusClass}">
                        ${config.status === 'OK' ? '‚úÖ OP√âRATIONNEL' : 
                          config.status === 'ERROR' ? '‚ùå ERREUR' : '‚ö†Ô∏è INCONNU'}
                    </div>
                    <div class="api-details">
                        <p><strong>Cl√©s disponibles:</strong> ${config.keys.length}</p>
                        <p><strong>Cl√© actuelle:</strong> key_${config.currentKeyIndex + 1}</p>
                        <p><strong>Requ√™tes:</strong> ${config.requests}</p>
                        <p><strong>Erreurs:</strong> ${config.errors}</p>
                        <p><strong>Dernier test:</strong> ${new Date().toLocaleTimeString('fr-FR')}</p>
                    </div>
                `;
                
                grid.appendChild(card);
            }
        }

        function logApi(source, message, type = 'info') {
            const now = new Date();
            const timeString = now.toLocaleTimeString('fr-FR', { 
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit'
            });
            
            const logItem = document.createElement('div');
            logItem.className = `log-item log-${type}`;
            logItem.innerHTML = `[${timeString}] <strong>${source}:</strong> ${message}`;
            
            const logsContainer = document.getElementById('api-logs');
            logsContainer.insertBefore(logItem, logsContainer.firstChild);
            
            // Garder seulement les 20 derniers logs
            const logs = logsContainer.children;
            if (logs.length > 20) {
                logsContainer.removeChild(logs[logs.length - 1]);
            }
            
            // Mettre √† jour l'heure dans le log
            document.getElementById('log-time').textContent = timeString;
            
            // Sauvegarder le log
            apiLogs.unshift({
                timestamp: now,
                source,
                message,
                type
            });
            
            if (apiLogs.length > 100) {
                apiLogs.pop();
            }
        }

        function clearApiLogs() {
            const logsContainer = document.getElementById('api-logs');
            logsContainer.innerHTML = '';
            
            const now = new Date();
            const timeString = now.toLocaleTimeString('fr-FR', { 
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit'
            });
            
            const logItem = document.createElement('div');
            logItem.className = 'log-item log-info';
            logItem.innerHTML = `[${timeString}] <strong>Syst√®me:</strong> Logs effac√©s`;
            logsContainer.appendChild(logItem);
            
            apiLogs = [];
        }

        // ============================================
        // FONCTIONS D'INTERFACE UTILISATEUR
        // ============================================

        function showTab(tabId) {
            // Cacher tous les onglets
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // D√©sactiver tous les boutons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Activer l'onglet s√©lectionn√©
            document.getElementById(tabId).classList.add('active');
            event.currentTarget.classList.add('active');
            
            // Si c'est l'onglet API, charger le statut
            if (tabId === 'api-tab') {
                updateApiStatusDisplay();
            }
        }

        function toggleFreezeMode() {
            isFrozen = !isFrozen;
            const freezeBtn = document.getElementById('freeze-btn');
            
            if (isFrozen) {
                freezeTime = new Date();
                freezeBtn.innerHTML = '<i class="fas fa-play"></i> Unfreeze Mode';
                freezeBtn.style.background = '#10b981';
                logApi('Syst√®me', 'Mode Freeze activ√© - Donn√©es fig√©es', 'warning');
            } else {
                freezeBtn.innerHTML = '<i class="fas fa-pause"></i> Freeze Mode';
                freezeBtn.style.background = '';
                logApi('Syst√®me', 'Mode Freeze d√©sactiv√©', 'success');
            }
        }

        function loadApiStatus() {
            showTab('api-tab');
        }

        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('fr-FR', { 
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit'
            });
            const dateString = now.toLocaleDateString('fr-FR', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            document.getElementById('current-time').textContent = 
                `${dateString} - ${timeString}`;
            
            setTimeout(updateTime, 1000);
        }

        function updateLastUpdateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('fr-FR', { 
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('last-update').textContent = timeString;
        }

        function updateConnectionStatus(status) {
            const statusElement = document.getElementById('connection-status');
            
            if (status === 'connected') {
                statusElement.className = 'connection-status status-connected';
                statusElement.innerHTML = '<i class="fas fa-circle"></i><span>Connect√© en temps r√©el</span>';
            } else {
                statusElement.className = 'connection-status status-disconnected';
                statusElement.innerHTML = '<i class="fas fa-circle"></i><span>Mode simulation</span>';
            }
        }

        // ============================================
        // GESTION DES √âV√âNEMENTS ET INITIALISATION
        // ============================================

        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                // Page cach√©e
                updateConnectionStatus('disconnected');
            } else {
                // Page visible
                updateConnectionStatus('connected');
            }
        });

        // Initialiser l'application au chargement
        document.addEventListener('DOMContentLoaded', initApp);

        // Exporter les fonctions pour la console (d√©bogage)
        window.tradingDashboard = {
            getAssetData: (symbol) => assets[symbol],
            getAllAssets: () => assets,
            updatePrices: updatePrices,
            testApis: testAllApis,
            rotateKeys: rotateAllKeys,
            toggleFreeze: toggleFreezeMode,
            getApiStatus: () => API_CONFIG
        };
    </script>
</body>
</html>
